<?php 

//---------------------------------RESTFULL--------------------------------
require '../function/functions.php';
require '../function/functions_deteksi.php';
require '../api/api_baru.php';
require '../api/api_recent.php';

$file_baru = $_GET["file"];
$ukuran_file_baru = $_GET['size'];
$sha256_baru = $_GET['sha256'];
$tipe_file_baru = $_GET['tipe'];

//cek apakah tombol submit sudah ditekan atau belum:
if (isset($_POST["submit"])) {
  $data = [
    'file_baru' => $file_baru,
    'ukuran_file_baru' => $ukuran_file_baru,
    'sha256_baru' => $sha256_baru,
    'pengirim' => "User",
    'email' => htmlspecialchars($_POST["email"])
  ];


  if( createBaru($data) === 0){
    echo "<script>
            alert('File GAGAL Diupload!');
            document.location.href = 'deteksi.php';
            </script>";
  } else {
      echo "<script>
            alert('File BERHASIL Diupload!');
            document.location.href = 'deteksi_tiket.php?sha256=$sha256_baru';
            </script>";

  } 
}

if (isset($_POST["batal"])) {
  $data = [
    'file_baru' => $file_baru,
    'ukuran_file_baru' => $ukuran_file_baru,
    'sha256_baru' => $sha256_baru,
    'pengirim' => "User",
    'email' => "Tanpa Email"
  ];

  if( createBaru($data) === 0){
    exit;
  } else {

    //cek apakah data berhasil ditambahkan atau tidak
    if( $result > 0){
      echo "<script>
            alert('File BERHASIL Diupload!');
            document.location.href = 'deteksi_tiket.php?sha256=$sha256_baru';
            </script>";
    } else {
      echo "<script>
            alert('File GAGAL Diupload!');
            document.location.href = 'deteksi.php';
            </script>";
    }
  }
}

?>


<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../fontawesome-web/css/all.min.css">
    <title>Sistem Database Malware</title>
  </head>

  <body class="mt-3">
    <!-- navbar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
      <div class="navbar-brand text-info">
      <img src="../../img/1.png" width="30" height="30"> Sistem Database Malware</div>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav ml-auto">
          <a class="nav-item nav-link" href="index.php"><i class="fas fa-home pr-1"></i>HOME</a>
          <a class="nav-item nav-link active" href="deteksi.php">DETEKSI<span class="sr-only">(current)</span></a>
          <a class="nav-item nav-link" href="riwayat.php">RIWAYAT</a>
          <a class="nav-item nav-link" href="../mitra/m.login.php">MITRA</a>
        </div>
      </div>
      </div>
    </nav>
    <!-- akhir navbar -->

    <!-- DETEKSI-perlu analisa -->
    <section class="deteksi_perlu_analisa" id="deteksi_perlu_analisa">
    <div class="container">
      <div class="row">
        <div class="col-sm-12 text-center text-dark">
          <hr class="border-secondary">
          <h2 class="font-weight-bold pt-5">DETEKSI MALWARE </h2>
        </div>
      </div>

      <div class="row">
        <div class="col text-center">
          <h6 class="pt-3 pb-2 mr-1">Status File:</h6>
        </div>
      </div>

      <div class="card">
        <div class="card-body">   
          <div class="card-header alert-info">
            <h3 class="font-weight-bold text-center">PERLU ANALISA</h3>
          </div> 

          <div class="row">
            <div class="col-3 text-center">
              <img src="../../img/22.png" width="200" class="pt-4"> 
              <h6 class="font-weight-bold text-center text-info py-3">PERLU ANALISA LEBIH LANJUT</h6>  
            </div>

            <div class="col-8 pb-3 text-center">
              <table class="table table-sm table-borderless text-info">
                <tbody><br>
                  <tr>
                    <td>Sistem Database Kami belum memiliki data tentang file yang Anda scan. Kami akan melakukan analisa lebih lanjut terhadap file ini. Jika Anda menginginkan informasi terkait hasil analisa file ini, silahkan masukkan email Anda:</td>
                  </tr>
                  <tr>
                    <td>
                      <form action="" method="post">
                        <div class="form-group row">
                          <label for="email" class="col-sm-3 text-right col-form-label font-weight-bold text-info">e-mail:</label>
                          <div class="col-sm-6"> 
                            <input type="email" id="email" name="email" class="form-control"  aria-describedby="emailHelp" required>
                            <small id="emailHelp" class="form-text text-muted">Pastikan email yang anda masukkan aktif</small>
                          </div>
                          <div>
                            <button type="submit" id="submit" name="submit" class="btn btn-info">Kirim</button>
                          </div>
                        </div>
                      </form>
                    </td>
                  </tr>
                  <tr>
                    <td>Kami akan mengirimkan hasil analisa kami melalui email.</td>
                  </tr>
                  <tr>
                    <td>Terimakasih.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="row">
            <div class="col-12">
              <h5 class="card-header font-weight-bold text-center alert-info">DATA FILE</h5>
              <table class="table table-sm mt-3">
                <tbody>
                <input type="hidden" name="id" value="<?= $baru["id_baru"]; ?>">
                  <tr>
                    <td>Signature (SHA256)</td>
                    <td>: <?= $sha256_baru ?></td>
                  </tr>
                  <tr>
                    <td>Nama File</td>
                    <td>: <?= $file_baru ?></td>
                  </tr>
                  <tr>
                    <td>Ukuran File</td>
                    <td>: <?= $ukuran_file_baru ?></td>
                  </tr>      
                  <tr>
                    <td>Tipe File</td>
                    <td>: <?= $tipe_file_baru ?></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="row justify-content-center">
        <form action="" method="post">
          <div class="col text-center mb-4 mt-3">
            <button type="submit" id="batal" name="batal" class="btn btn-secondary">Batal</button>
          </div>
        </form>
      </div>
    </div>
    </section>
    <!-- akhir DETEKSI-perlu analisa -->

    <!-- footer -->
    <footer class="bg-dark text-white">
      <div class="row pt-3">
        <div class="col text-center">
          <p>&copy; Copyright 2020 | by Rela Annisa Camilia.</p>
        </div>
      </div>
    </footer>
    <!-- akhir footer -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script type="text/javascript" src="../../js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../../js/popper.min.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.min.js"></script>
  </body>
</html>