<?php 
session_start();
if( !isset($_SESSION["m.login"])){
  header("Location: m.login.php");
  exit;
}

//----------------------------RESTFULL-------------------------
require '../function/functions.php';
require '../api/api_malware.php';

//ambil id akun mitra
$idm = $_GET['idm'];
$getMal = getAllMalware();

//pagination
$jumlahDataPerHalaman = 10;
$jumlahData = count($getMal); //18
$jumlahHalaman = ceil($jumlahData / $jumlahDataPerHalaman); //4
$halamanAktif = (isset($_GET["halaman"])) ? $_GET["halaman"] : 1; //1
$awalData = ($jumlahDataPerHalaman * $halamanAktif) - $jumlahDataPerHalaman; //0

if($j = $awalData){
  $malware = [];
}

$k = 0;
while($k < $jumlahDataPerHalaman){
    
    if($j+1 <= $jumlahData){
      $malware[] = $getMal[$j];
      $j++; 
    }
    $k++;
}

?>

<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../fontawesome-web/css/all.min.css">
    <title>Sistem Database Malware</title>
  </head>

  <body class="mt-3">
    <!-- navbar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-info">
      <div class="container">
      <div class="navbar-brand text-light">
      <img src="../../img/1.png" width="30" height="30"> Sistem Database Malware</div>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <div class="navbar-nav font-weight-bold">
        <div class="row text-center ml-5">
          <a class="nav-item nav-link ml-5" href="m.akun.php?idm=<?=$idm;?>">PROFIL</a>
          <a class="nav-item nav-link" href="m.index.php?idm=<?=$idm;?>">MENU</a>
          <a class="nav-item nav-link" href="m.deteksi.php?idm=<?=$idm;?>">DETEKSI</a>
          <a class="nav-item nav-link active" href="m.lab.php?idm=<?=$idm;?>">LAB<span class="sr-only">(current)</span></a>
          <a class="nav-item nav-link" href="m.riwayat.php?idm=<?=$idm;?>">RIWAYAT</a>
        </div>
        </div>
        <div class="navbar-nav ml-auto">
          <a class="nav-item nav-link btn btn-sm btn-outline-dark font-weight-bold" data-toggle="modal" data-target="#logoutModal"><i class="fas fa-sign-out-alt pr-1"></i>Logout</a>
        </div>
      </div>
      </div>
    </nav>
    <!-- akhir navbar -->

    <!-- menu LAB malware -->
    <section class="sampel" id="sampel">
      <div class="container"><br>
        <h2 class="text-center text-dark font-weight-bold pt-5">LABORATORIUM MALWARE</h2>
      
      <div class="row">
        <div class="col-sm-6 offset-3 text-center text-dark pt-1">
          <p class="text-center pt-1">Metadata & Analisa Malware</p>
        </div>

        <div class="col-sm-3">
        <!-- pagination -->
        <nav aria-label="Page navigation example">
          <ul class="pagination justify-content-center">
          <li class="page-item">
              <?php if($halamanAktif > 1) : ?>
                <a href="?idm=<?=$idm;?>&halaman=<?= $halamanAktif - 1; ?>" class="page-link" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              <?php else : ?>
                <a href="?idm=<?=$idm;?>&halaman=<?= $halamanAktif; ?>" class="page-link" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              <?php endif; ?>
            </li>

            <?php for( $i=1; $i<=$jumlahHalaman; $i++) : ?>
              <?php if( $i == $halamanAktif) : ?>

                <?php if( $i === 1) :?>
                  <li class="page-item"><a class="page-link" href="?idm=<?=$idm;?>&halaman=<?= $i; ?>">-</a></li>
                <?php else : ?>
                  <li class="page-item"><a class="page-link" href="?idm=<?=$idm;?>&halaman=<?= $i-1; ?>"><?= $i-1; ?></a></li>
                <?php endif;?>

                <li class="page-item active" aria-current="page"><a class="page-link" href="?idm=<?=$idm;?>&halaman=<?= $i; ?>"><?= $i; ?></a></li>

                <?php if( $i == $jumlahHalaman) : ?>
                  <li class="page-item"><a class="page-link" href="?idm=<?=$idm;?>&halaman=<?= $i; ?>">-</a></li>
                <?php else: ?>
                  <li class="page-item"><a class="page-link" href="?idm=<?=$idm;?>&halaman=<?= $i+1; ?>"><?= $i+1; ?></a></li>
                <?php endif;?>

              <?php endif; ?>
            <?php endfor; ?>

            <li class="page-item">
              <?php if($halamanAktif < $jumlahHalaman) : ?>
                <a href="?idm=<?=$idm;?>&halaman=<?= $halamanAktif + 1; ?>" class="page-link" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              <?php else : ?>
                <a href="?idm=<?=$idm;?>&halaman=<?= $halamanAktif; ?>" class="page-link" aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              <?php endif; ?>
            </li>
          </ul>
        </nav>
        <!-- akhir pagination -->
        </div>
      </div>

      <table class="table table-responsive-md table-bordered table-sm text-center">
      <thead>
        <tr class="table-info">
          <th scope="col" class="align-middle">No</th>
          <th scope="col" class="align-middle">Nama File</th>
          <th scope="col" class="align-middle">Ukuran File</th>
          <th scope="col" class="align-middle">Jenis Malware</th>
          <th scope="col" class="align-middle">Signature (SHA256)</th>
          <th scope="col" class="align-middle">Unduh Malware</th>
          <th scope="col" class="align-middle">Info Malware</th>
        </tr>
      </thead>
      <tbody>
        <?php $no = ($halamanAktif>1)? ($awalData+1) :1;?>
        <?php foreach($malware as $row): ?>
        <tr>
          <th scope="row"><?= $no++; ?></th>
            <td><?= $row["file_malware"]; ?></td>
            <td><?= $row["ukuran_file_malware"]; ?></td>
            <td><?= $row["jenis"]; ?></td>
            <td><?= $row["sha256_malware"]; ?></td>
            <td><a href="m.lab_unduh.php?idm=<?=$idm;?>&id=<?= $row["id_malware"];?>" class="btn btn-danger btn-sm" onclick="return confirm('Apakah anda yakin akan mengunduh file ini?')"><i class="fas fa-download pr-2"></i>Unduh</a></td> 
            <td><a href="m.lab_detail.php?idm=<?=$idm;?>&id=<?= $row["id_malware"];?>" class="btn btn-info btn-sm"><i class="fas fa-info-circle pr-2"></i>Detail</a></td> 
        </tr>
        <?php endforeach; ?>
      </tbody>
    </table>

    </div>
    </section><br><br><br>
    <!-- akhir menu LAB malware -->

    <!-- menu LOGOUT -->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="logoutModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="logoutModalLabel">LOGOUT</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            Apakah anda yakin akan keluar dari akun Mitra Anda?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Batal</button>
            <a href="m.logout.php"><button type="button" class="btn btn-info">Keluar</button></a>
          </div>
        </div>
      </div>
    </div>
    <!-- akhir menu LOGOUT --> 

    <!-- footer -->
    <footer class="bg-info text-white fixed-bottom">
      <div class="row pt-3">
        <div class="col text-center">
          <p>&copy; Copyright 2020 | by Rela Annisa Camilia.</p>
        </div>
      </div>
    </footer>
    <!-- akhir footer -->

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script type="text/javascript" src="../../js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="../../js/popper.min.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.min.js"></script>
  </body>
</html>