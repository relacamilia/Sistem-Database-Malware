<?php

require '../../guzzle/vendor/autoload.php';
use GuzzleHttp\Client;

$client = new Client([
    'base_uri' => 'http://localhost/tesisrela/rest-server/api/'
]);
 

//------------------------------- GET ALL | MENAMPILKAN --------------------------------
function getAllBaru(){

    global $client;    
    $response = $client->request('GET', "baru", []);
    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'];

}


//-------------------------------- GET BY ID | DETAIL ----------------------------------
function getBaruById($id){

    global $client;
    $response = $client->request('GET', "baru", [
        'query' => ['id_baru' => $id]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'][0];

}


//-------------------------------- GET BY ID | DETAIL ----------------------------------
function getBaruByHash($sha256_user){

    global $client;
    $response = $client->request('GET', "baru", [
        'query' => ['sha256' => $sha256_user]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);

    if (($result["status"]) === 0 ) {
        return 0;
    } else {
        return $result['data'][0];
    }
}


//--------------------------------- DELETE | HAPUS -----------------------------------
function deleteBaru($id){

    global $client;
    $response = $client->request('DELETE', "baru", [
        'form_params' => ['id_baru' => $id]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result;

}


//------------------------------------CREATE-------------------------------------------
function createBaru($data){

    global $client;
    $file = explode(".", $data['file_baru']);
    $file_baru = $file[0]. ".zip";

    $data = [
        'file_baru' => $file_baru,
        'waktu_input' => date("d-m-Y"),
        'tipe_file_baru' => "zip",
        'ukuran_file_baru' => $data['ukuran_file_baru'],
        'sha256_baru' => $data['sha256_baru'],  
        'pengirim' => $data['pengirim'],
        'email' => htmlspecialchars($data['email']),      
        'status' => "Perlu Analisa"    
    ];

    $response = $client->request('POST', 'baru', [
        'form_params' => $data
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    if(($result['status']) === 0 ){
        return 0;
    } else {
        return 1;
    }

}


//-----------------------------------UPLOAD-------------------------------------
function uploadBaru($file, $file_user){

    global $client;

    $data = [
        'contents' => $file,
        'file_baru' => $file_user  
    ];

    $response = $client->request('POST', 'baru', [
        'form_params' => $data
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    if(($result['status']) === 0 ){
        return 0;
    } else {
        return 1;
    }

}

?>