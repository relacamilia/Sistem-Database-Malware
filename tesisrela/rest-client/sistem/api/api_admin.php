<?php

require '../../guzzle/vendor/autoload.php';
use GuzzleHttp\Client;

$client = new Client([
    'base_uri' => 'http://localhost/tesisrela/rest-server/api/'
]);
 

//------------------------------- GET ALL | MENAMPILKAN --------------------------------
function getAllAdmin(){

    global $client;    
    $response = $client->request('GET', "admin", []);
    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'];

}


//-------------------------------- GET BY ID | DETAIL ----------------------------------
function getAdminById($id){

    global $client;
    $response = $client->request('GET', "admin", [
        'query' => ['id_admin' => $id]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'][0];

}


//----------------------------- GET BY USERNAME | LOGIN---------------------------------
function getAdminByUsername($username){

    global $client;
    $response = $client->request('GET', "admin", [
        'query' => ['username' => $username]
    ]);
    
    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'][0];

}


//--------------------------------- DELETE | HAPUS -----------------------------------
function deleteAdmin($id){

    global $client;
    $response = $client->request('DELETE', "admin", [
        'form_params' => ['id_admin' => $id]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result;

}


//---------------------------------- CREATE | TAMBAH ---------------------------------
function createAdmin($dataMal){

    global $client;
    $password= htmlspecialchars($dataMal["password"]);
	$password = password_hash($password, PASSWORD_DEFAULT);

    $data = [
        
        'nama' => htmlspecialchars($dataMal["nama"]),
        'username' => strtolower(stripslashes($dataMal["username"])),
        'password' => $password,
        'email' => htmlspecialchars($dataMal["email"])

    ];

    $response = $client->request('POST', 'admin', [
        'form_params' => $data
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result;
}

?>