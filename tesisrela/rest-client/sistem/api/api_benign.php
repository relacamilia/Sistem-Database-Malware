<?php

require '../../guzzle/vendor/autoload.php';
use GuzzleHttp\Client;

$client = new Client([
    'base_uri' => 'http://localhost/tesisrela/rest-server/api/'
]);
 

//------------------------------- GET ALL | MENAMPILKAN --------------------------------
function getAllBenign(){

    global $client;    
    $response = $client->request('GET', "benign", []);
    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'];

}


//-------------------------------- GET BY ID | DETAIL ----------------------------------
function getBenignById($id){

    global $client;
    $response = $client->request('GET', "benign", [
        'query' => ['id_benign' => $id]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result['data'][0];

}


//-------------------------------- GET BY HASH | DETAIL ----------------------------------
function getBenignByHash($sha256_user){

    global $client;
    $response = $client->request('GET', "benign", [
        'query' => ['sha256' => $sha256_user]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    
    if (($result["status"]) === 0 ) {
        return 0;
    } else {
        return $result['data'][0];
    }
}


//--------------------------------- DELETE | HAPUS -----------------------------------
function deleteBenign($id){

    global $client;
    $response = $client->request('DELETE', "benign", [
        'form_params' => ['id_benign' => $id]
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result;

}


//---------------------------------- CREATE | TAMBAH ---------------------------------
function createBenign($dataMal){

    global $client;
    $contents = $_FILES['file_benign']['tmp_name'];
    $name = $_FILES['file_benign']['name'];

    $data = [

        'contents' => $contents,
        'file_benign' => $name,
        'tipe_file_benign' => "zip",
        'ukuran_file_benign' => formatBytes($_FILES['file_benign']['size']),
        'md5_benign' => $md5 = hash_file('md5', $contents),
        'sha1_benign' => $sha1 = hash_file('sha1', $contents),
        'sha256_benign' => $sha256_benign = hash_file('sha256', $contents)        

    ];

    $response = $client->request('POST', 'benign', [
        'form_params' => $data
    ]);

    $result = json_decode($response->getBody()->getContents(),true);
    return $result["status"];

}

?>