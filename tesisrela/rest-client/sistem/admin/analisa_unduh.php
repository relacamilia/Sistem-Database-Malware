<?php 

//--------------------------RESTFULL----------------------------
require '../api/api_baru.php';
require '../api/api_recent.php';
require '../api/api_admin.php';


$id = $_GET['id'];
$ida = $_GET['ida'];
$admin = getAdminById($ida);

if (isset($id)){
	$baru = getBaruById($id);
	$filename = $baru['file_baru'];

	//input ke recent
	$dataRec = [
        'file' => $baru["file_baru"],
        'sha256' => $baru["sha256_baru"],
        'status' => "File Baru",
		'aksi' => "Diunduh",
		'oleh' => $admin["username"]
      ];

    if( createRecent($dataRec) === 0){
        echo "<script>
              alert('Data Gagal ditambahkan ke recent!');
              document.location.href = 'analisa.php?ida=$ida';
              </script>";
    }
	
	//unduh file
	$file = ("../../../rest-server/directory/file_baru/$filename");
	if(file_exists($file)){
		header('Content-Description: File Transfer');
		header('Content-Type: application/octet-stream');
		header('Content-Disposition: attachment; filename='.basename($file));
		header('Expires:0');
		header('Cache-Control: private');
		header('Pragma: private');
		header('Content-Length:'.filesize($file));
		ob_clean();
		flush();
		readfile($file);
		exit;
	}
	echo "<script>
              alert('File tidak ada dalam directory!');
              document.location.href = 'analisa.php?ida=$ida';
              </script>";
}
?>