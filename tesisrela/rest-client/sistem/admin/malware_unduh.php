<?php 

//----------------------------------RESTFULL-----------------------------
require '../function/functions.php';
require '../api/api_malware.php';
require '../api/api_recent.php';
require '../api/api_admin.php';

$ida = $_GET['ida'];
$admin = getAdminById($ida);

$id = $_GET['id'];

if (isset($id)){
	$mal = getMalwareById($id);
	$filename = $mal['file_malware'];

	//input ke recent
	$dataRec = [
        'file' => $mal["file_malware"],
        'sha256' => $mal["sha256_malware"],
        'status' => "Malware",
		'aksi' => "Diunduh",
		'oleh' => $admin["username"]
      ];

    if( createRecent($dataRec) === 0){
        echo "<script>
              alert('Data Gagal ditambahkan ke recent!');
              document.location.href = 'malware.php?ida=$ida';
              </script>";
    }
	
	//unduh file
	$file = ("../../../rest-server/directory/file_malware/$filename");
	if(file_exists($file)){
		header('Content-Description: File Transfer');
		header('Content-Type: application/octet-stream');
		header('Content-Disposition: attachment; filename='.basename($file));
		header('Expires:0');
		header('Cache-Control: private');
		header('Pragma: private');
		header('Content-Length:'.filesize($file));
		ob_clean();
		flush();
		readfile($file);
		exit;
	}
	echo "<script>
              alert('File tidak ada dalam directory!');
              document.location.href = 'malware.php?ida=$ida';
              </script>";
}

?>