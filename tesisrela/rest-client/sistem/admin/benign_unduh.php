<?php 

//-------------------------RESTFULL----------------------------
require '../function/functions.php';
require '../api/api_benign.php';
require '../api/api_recent.php';
require '../api/api_admin.php';

$id = $_GET['id'];
$ida = $_GET['ida'];
$admin = getAdminById($ida);

if (isset($id)){
	$ben = getBenignById($id);
	$filename = $ben['file_benign'];

	//input ke recent
	$dataRec = [
        'file' => $ben["file_benign"],
        'sha256' => $ben["sha256_benign"],
        'status' => "Benign",
		'aksi' => "Diunduh",
		'oleh' => $admin["username"]
      ];

    if( createRecent($dataRec) === 0){
        echo "<script>
              alert('Data Gagal ditambahkan ke recent!');
              document.location.href = 'benign.php?ida=$ida';
              </script>";
    }
	
	//unduh file
	$file = ("../../../rest-server/directory/file_benign/$filename");
	if(file_exists($file)){
		header('Content-Description: File Transfer');
		header('Content-Type: application/octet-stream');
		header('Content-Disposition: attachment; filename='.basename($file));
		header('Expires:0');
		header('Cache-Control: private');
		header('Pragma: private');
		header('Content-Length:'.filesize($file));
		ob_clean();
		flush();
		readfile($file);
		exit;
	}	
	echo "<script>
              alert('File tidak ada dalam directory!');
              document.location.href = 'malware.php?ida=$ida';
              </script>";
}

?>