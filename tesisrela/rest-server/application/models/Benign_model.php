<?php

class Benign_model extends CI_Model
{
    //-----------------------------------GET------------------------------
    public function getBenign($id = null)
    {
        if($id === null){
            return $this->db->get('benign')->result_array();
        } else {
            return $this->db->get_where('benign', ['id_benign' => $id])->result_array();
        }
    }


    //-----------------------------GET BY HASH------------------------
    public function getBenignByHash($sha256)
    {
        return $this->db->get_where('benign', ['sha256_benign' => $sha256])->result_array();
    }
    
    
    //----------------------------UPLOAD--------------------------------
    //----------------------------ZIP & UPLOAD------------------------------
    public function uploadBenign($contents, $fileName)
    {    
        //password ZIP
        $password = "Rahasia100%";
    
        //nama file ZIP
        $explode = explode('.', $fileName);
        $namaFile = $explode[0];
    
        //buat PHP Library
        $zip = new ZipArchive();
        $fileKompresi = "directory/file_benign/".$namaFile.".zip";
        $zip->open($fileKompresi, ZIPARCHIVE::CREATE);  
        $zip->addEmptyDir('newDirectory');
      
        //set password 
        $zip->setPassword($password);

        $isi = file_get_contents($contents);
        
        $zip->addFromString($fileName, $isi); 
        
        //enkripsi file
        $zip->setEncryptionName($fileName, ZipArchive::EM_AES_256); 
    
        $zip->close(); 
    
        $file_benign = $namaFile.".zip";
        return $file_benign;
    }

    //----------------------------------DELETE-------------------------------
    public function deleteBenign($id)
    {
        $this->db->delete('benign', ['id_benign' => $id]);
        return $this->db->affected_rows();
    }


    //----------------------------------CREATE--------------------------------
    public function createBenign($data)
    {
        $this->db->insert('benign', $data);
        return $this->db->affected_rows();
    }


    //---------------------------------UPDATE--------------------------------
    public function updateBenign($data, $id)
    {
        $this->db->update('benign', $data, ['id_benign' => $id]);
        return $this->db->affected_rows();
    }
}

?>