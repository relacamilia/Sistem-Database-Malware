<?php

class Malware_model extends CI_Model
{   
    
    //--------------------------GET (all | by Id)---------------------------
    public function getMalware($id = null)
    {
        if($id === null){
            return $this->db->get('malware')->result_array();
        } else {
            return $this->db->get_where('malware', ['id_malware' => $id])->result_array();
        }
    }


    //-----------------------------GET BY HASH------------------------------
    // cek data di db malware
    public function getMalwareByHash($sha256)
    {
        return $this->db->get_where('malware', ['sha256_malware' => $sha256])->result_array();
    }


    //----------------------------ZIP & UPLOAD------------------------------
    public function uploadMalware($contents, $fileName)
    {    
        //password ZIP
        $password = "Rahasia100%";
    
        //nama file ZIP
        $explode = explode('.', $fileName);
        $namaFile = $explode[0];
    
        //buat PHP Library
        $zip = new ZipArchive();
        $fileKompresi = "directory/file_malware/".$namaFile.".zip";
        $zip->open($fileKompresi, ZIPARCHIVE::CREATE);  
        $zip->addEmptyDir('newDirectory');
      
        //set password 
        $zip->setPassword($password);
        
        $isi = file_get_contents($contents);
        
        $zip->addFromString($fileName, $isi); 
        
        //enkripsi file
        $zip->setEncryptionName($fileName, ZipArchive::EM_AES_256); 
    
        $zip->close(); 
    
        $file_malware = $namaFile.".zip";
        return $file_malware;
    }

    //------------------------------CREATE-----------------------
    public function createMalware($data)
    {
        $this->db->insert('malware', $data);
        return $this->db->affected_rows();
    }


    //--------------------------------DELETE--------------------------------
    public function deleteMalware($id)
    {
        $this->db->delete('malware', ['id_malware' => $id]);
        return $this->db->affected_rows();
    }


    //--------------------------------UPDATE--------------------------------
    public function updateMalware($data, $id)
    {
        $this->db->update('malware', $data, ['id_malware' => $id]);
        return $this->db->affected_rows();
    }

}

?>