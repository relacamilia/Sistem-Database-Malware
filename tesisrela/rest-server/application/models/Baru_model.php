<?php

class Baru_model extends CI_Model
{   
    //-----------------------------------GET--------------------------------------------------
    public function getBaru($id = null)
    {
        if($id === null){
            return $this->db->get('baru')->result_array();
        } else {
            return $this->db->get_where('baru', ['id_baru' => $id])->result_array();
        }
    }


    //get by hash
    public function getBaruByHash($sha256)
    {
        return $this->db->get_where('baru', ['sha256_baru' => $sha256])->result_array();
    }


    //-----------------------------------DELETE-------------------------------------------------
    public function deleteBaru($id)
    {
        $this->db->delete('baru', ['id_baru' => $id]);
        return $this->db->affected_rows();
    }


    //-----------------------------------UPLOAD-------------------------------------
    // zip dan upload baru
    public function uploadBaru($contents, $fileName)
    {    
        //password ZIP
        $password = "Rahasia100%";
    
        //nama file ZIP
        $explode = explode('.', $fileName);
        $namaFile = $explode[0];
    
        //buat PHP Library
        $zip = new ZipArchive();
        $fileKompresi = "directory/file_baru/".$namaFile.".zip";
        $zip->open($fileKompresi, ZIPARCHIVE::CREATE);  
        $zip->addEmptyDir('newDirectory');
      
        //set password 
        $zip->setPassword($password);

        $isi = file_get_contents($contents);
        
        $zip->addFromString($fileName, $isi); 
        
        //enkripsi file
        $zip->setEncryptionName($fileName, ZipArchive::EM_AES_256); 
    
        $zip->close(); 
    
        $file_baru = $namaFile.".zip";
        return $file_baru;
    }


    //------------------------------------CREATE--------------------------------------------------
    public function createBaru($data)
    {
        $this->db->insert('baru', $data);
        return $this->db->affected_rows();
    }

}

?>